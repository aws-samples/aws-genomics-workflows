



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-3.1.0">
    
    
      
        <title>Installing the Genomics Workflow Core and Cromwell - Genomics Workflows on AWS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installing-the-genomics-workflow-core-and-cromwell" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Genomics Workflows on AWS" class="md-header-nav__button md-logo">
          
            <img src="../images/AWS_logo_RGB_REV.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Genomics Workflows on AWS
              </span>
              <span class="md-header-nav__topic">
                Installing the Genomics Workflow Core and Cromwell
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/aws-samples/aws-genomics-workflows/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Contribute
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Genomics Workflows on AWS" class="md-nav__button md-logo">
      
        <img src="../images/AWS_logo_RGB_REV.svg" width="48" height="48">
      
    </a>
    Genomics Workflows on AWS
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/aws-samples/aws-genomics-workflows/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Contribute
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../disclaimer.html" title="Disclaimer" class="md-nav__link">
      Disclaimer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quick-start.html" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Core Environment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Core Environment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../core-env/introduction.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core-env/create-s3-bucket.html" title="Data Storage" class="md-nav__link">
      Data Storage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core-env/create-iam-roles.html" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core-env/create-custom-compute-resources.html" title="Compute Resources" class="md-nav__link">
      Compute Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core-env/setup-aws-batch.html" title="AWS Batch" class="md-nav__link">
      AWS Batch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core-env/custom-deploy.html" title="Customized Deployment" class="md-nav__link">
      Customized Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../core-env/build-custom-distribution.html" title="Building a Custom Distribution" class="md-nav__link">
      Building a Custom Distribution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Workflow Orchestration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Workflow Orchestration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/orchestration-intro.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      AWS Step Functions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        AWS Step Functions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/step-functions/step-functions-overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Cromwell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Cromwell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/cromwell/cromwell-overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/cromwell/cromwell-examples.html" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/cromwell/cromwell-trouble-shooting.html" title="Trouble Shooting" class="md-nav__link">
      Trouble Shooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Nextflow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        Nextflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/nextflow/nextflow-overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/nextflow/nextflow-trouble-shooting.html" title="Trouble Shooting" class="md-nav__link">
      Trouble Shooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration/cost-effective-workflows/cost-effective-workflows.html" title="Cost Effective Workflows" class="md-nav__link">
      Cost Effective Workflows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" title="Summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions" title="Assumptions" class="md-nav__link">
    Assumptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-of-genomics-workflow-core-into-an-existing-vpc" title="Deployment of Genomics Workflow Core into an existing VPC." class="md-nav__link">
    Deployment of Genomics Workflow Core into an existing VPC.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-cromwell-resources" title="Deploy Cromwell Resources" class="md-nav__link">
    Deploy Cromwell Resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-deployment" title="Testing your Deployment" class="md-nav__link">
    Testing your Deployment
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-genomics-workflows/edit/master/docs/install-cromwell/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="installing-the-genomics-workflow-core-and-cromwell">Installing the Genomics Workflow Core and Cromwell</h1>
<h2 id="summary">Summary</h2>
<p>The purpose of this document is to demonstrate how an AWS user can provision the infrastructure necessary to run Cromwell versions 52 and beyond on AWS Batch using S3 as an object store using CloudFormation. The instructions cover deployment into an existing VPC. There are two main steps: deploying the genomics workflow core infrastructure which can be used with Cromwell, Nextflow and AWS Step Functions, and the deployment of the Cromwell server and related artifacts.</p>
<hr />
<h2 id="assumptions">Assumptions</h2>
<ol>
<li>The instructions assume you have an existing AWS account with sufficient credentials to deploy the infrastructure or that you will use a role with CloudFormation that has sufficient privileges (admin role is recommended).</li>
<li>You have an existing VPC to deploy artifacts into. This VPC should have a minimum of two subnets with routes to the public internet. Private subnet routes may be through a NAT Gateway.</li>
</ol>
<hr />
<h2 id="deployment-of-genomics-workflow-core-into-an-existing-vpc">Deployment of Genomics Workflow Core into an existing VPC.</h2>
<p>Take note of the id of the VPC that you will use and the ids of the subnets of the VPC that you will use for the Batch worker nodes. We recommend using two or more private subnets. </p>
<ol>
<li>Open the CloudFormation consoles and select “<strong>Create stack</strong>” with new resources. Enter <code>https://aws-genomics-workflows.s3.amazonaws.com/latest/templates/gwfcore/gwfcore-root.template.yaml</code> as the Amazon S3 URL.</li>
</ol>
<p><img alt="" src="images/screen1.png" /></p>
<ol>
<li>Select appropriate values for your environment including the VPC and subnets you recorded above. It is recommended to leave the Default and High Priority Min vCPU values at 0 so that the AWS Batch cluster will not have any instances running when there are no workflows running. Max vCPU values may be increased if you expect to run large workloads utilizing many CPUs. Leave the Distribution Configuration values with the preset defaults.</li>
</ol>
<p><img alt="" src="images/screen2.png" /></p>
<ol>
<li>
<p>Optionally add tags and click <strong>Next</strong></p>
</li>
<li>
<p>Review the parameters, acknowledge the Capabilities notifications and click “<strong>Create Stack</strong>”</p>
</li>
</ol>
<p><img alt="" src="images/screen5.png" /></p>
<p>The template will now create several nested stacks to deploy the required resources. This step will take approximately 10 minutes to complete. When this is complete you can proceed with the “<a href="#deploy-cromwell-resources">Deploy Cromwell Resources</a>” section below.</p>
<hr />
<h2 id="deploy-cromwell-resources">Deploy Cromwell Resources</h2>
<ol>
<li>Ensure all steps of the CloudFormation deployment of the Genomics Workflow Core have successfully completed before proceeding any further.</li>
<li>From the CloudFormation console select “<strong>Create Stack</strong>” and if prompted select “<strong>With new resources (Standard)</strong>”</li>
<li>Fill in the Amazon S3 URL with <code>https://aws-genomics-workflows.s3.amazonaws.com/latest/templates/cromwell/cromwell-resources.template.yaml</code></li>
</ol>
<p><img alt="" src="images/screen3.png" /></p>
<ol>
<li>Fill in appropriate values for the template. <strong>For <code>GWFCoreNamespace</code> use the names space value you used in the section above</strong><strong>.</strong> You should use the same VPC as you used in the previous step above. To secure your Cromwell server you should change the <code>SSH Address Range</code> and <code>HTTP Address Range</code> to trusted values, these will be used when creating the servers security group. </li>
<li>You may either use the latest version of Cromwell (recommended) or specify a version <strong>52 or greater.</strong></li>
<li>Select a MySQL compliant <code>Cromwell Database Password</code> that will be used for Cromwell’s metadata database. Select “<strong>Next”</strong>.</li>
</ol>
<p><img alt="" src="images/screen4.png" /></p>
<ol>
<li>On the remaining two screens keep the defaults, acknowledge the IAM capabilities and then click “<strong>Create Stack</strong>”</li>
</ol>
<p>Once the stack completes an EC2 will be deployed and it will be running an instance of the Cromwell server. You can now proceed with "<a href="#testing-your-deployment">Testing your deployment</a>"</p>
<hr />
<h2 id="testing-your-deployment">Testing your Deployment</h2>
<p>The following WDL file is a very simple workflow that can be used to test that all the components of the deployment are working together. Add the code block below to a file named <code>workflow.wdl</code></p>
<pre><code>workflow helloWorld {
    call sayHello
}

task sayHello {
    command {
        echo &quot;hello world&quot;
    }
    output {
        String out = read_string(stdout())
    }

    runtime {
       docker: &quot;ubuntu:latest&quot;
       memory: &quot;1 GB&quot;
       cpu: 1
    }
}
</code></pre>
<p>This task can be submitted to the servers REST endpoint using <code>curl</code> either from a client that has access to the servers elastic IP or from within the server itself using <code>localhost.</code> The hostname of the server is also emitted as an output from the cromwell-resources CloudFormation template.</p>
<pre><code>curl -X POST &quot;http://localhost:8000/api/workflows/v1&quot; \
     -H &quot;accept: application/json&quot; \
     -F &quot;workflowSource=@workflow.wdl&quot;
</code></pre>
<p>It can take a few minutes for AWS Batch to realize there is a job in the work queue and provision a worker to run it. You can monitor this in the AWS Batch console. </p>
<p>You can also monitor the Cromwell server logs in CloudWatch. There will be a log group called <code>cromwell-server.</code> Once the run is completed you will see output similar to:</p>
<p><img alt="" src="images/screen5.png" /></p>
<p>If the run is successful subsequent runs will be “call cached” meaning that the results of the previous run will be copied for all successful steps. If you resubmit the job you will very quickly see the workflow success in the server logs and no additional jobs will be seen in the AWS Batch console. You can disable call caching for the job by adding an options file and submitting it with the run. This will cause the workflow to be re-executed in full.</p>
<pre><code class="language-json5">{
    &quot;write_to_cache&quot;: false,
    &quot;read_from_cache&quot;: false
}
</code></pre>
<pre><code class="language-shell">curl -X POST &quot;http://localhost:8000/api/workflows/v1&quot; \
     -H &quot;accept: application/json&quot; \
     -F &quot;workflowSource=@workflow.wdl&quot; \
     -F &quot;workflowOptions=@options.json&quot;
</code></pre>
<p>For a more realistic workflow, a WDL for simple variant calling using bwa-mem, samtools, and bcftools is available <a href="https://github.com/wleepang/demo-genomics-workflow-wdl">here</a>:</p>
<p>Clone the repo, and submit the WDL file to cromwell. The workflow uses default inputs from public data sources. If you want to override these inputs, modify the <code>inputs.json</code> file accordingly and submit it along with the workflow.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019 Amazon Web Services
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.3.0",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>