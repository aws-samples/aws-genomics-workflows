



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-3.1.0">
    
    
      
        <title>Examples - Genomics Workflows on AWS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.11e41852.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cromwell-examples" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="Genomics Workflows on AWS" class="md-header-nav__button md-logo">
          
            <img src="../../images/AWS_logo_RGB_REV.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Genomics Workflows on AWS
              </span>
              <span class="md-header-nav__topic">
                Examples
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/aws-samples/aws-genomics-workflows/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Contribute
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="Genomics Workflows on AWS" class="md-nav__button md-logo">
      
        <img src="../../images/AWS_logo_RGB_REV.svg" width="48" height="48">
      
    </a>
    Genomics Workflows on AWS
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/aws-samples/aws-genomics-workflows/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Contribute
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../index.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../disclaimer.html" title="Disclaimer" class="md-nav__link">
      Disclaimer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../quick-start.html" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Core Environment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Core Environment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-env/introduction.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-env/create-s3-bucket.html" title="Data Storage" class="md-nav__link">
      Data Storage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-env/create-iam-roles.html" title="Permissions" class="md-nav__link">
      Permissions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-env/create-custom-compute-resources.html" title="Compute Resources" class="md-nav__link">
      Compute Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-env/setup-aws-batch.html" title="AWS Batch" class="md-nav__link">
      AWS Batch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-env/custom-deploy.html" title="Customized Deployment" class="md-nav__link">
      Customized Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core-env/build-custom-distribution.html" title="Building a Custom Distribution" class="md-nav__link">
      Building a Custom Distribution
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Workflow Orchestration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Workflow Orchestration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../orchestration-intro.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      AWS Step Functions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        AWS Step Functions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../step-functions/step-functions-overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3" checked>
    
    <label class="md-nav__link" for="nav-5-3">
      Cromwell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Cromwell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="cromwell-overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Examples
      </label>
    
    <a href="cromwell-examples.html" title="Examples" class="md-nav__link md-nav__link--active">
      Examples
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-hello-world" title="Simple Hello World" class="md-nav__link">
    Simple Hello World
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-definition" title="Workflow Definition" class="md-nav__link">
    Workflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#call-caching" title="Call Caching" class="md-nav__link">
    Call Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world-with-inputs" title="Hello World with inputs" class="md-nav__link">
    Hello World with inputs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-definition_1" title="Workflow Definition" class="md-nav__link">
    Workflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputs" title="Inputs" class="md-nav__link">
    Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow_1" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-data-on-s3" title="Using data on S3" class="md-nav__link">
    Using data on S3
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-definition_2" title="Workflow Definition" class="md-nav__link">
    Workflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputs_1" title="Inputs" class="md-nav__link">
    Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow_2" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-example-haplotypecaller" title="Real-world example: HaplotypeCaller" class="md-nav__link">
    Real-world example: HaplotypeCaller
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#worflow-definition" title="Worflow Definition" class="md-nav__link">
    Worflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputs_2" title="Inputs" class="md-nav__link">
    Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow_3" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="cromwell-trouble-shooting.html" title="Trouble Shooting" class="md-nav__link">
      Trouble Shooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Nextflow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        Nextflow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../nextflow/nextflow-overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nextflow/nextflow-trouble-shooting.html" title="Trouble Shooting" class="md-nav__link">
      Trouble Shooting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cost-effective-workflows/cost-effective-workflows.html" title="Cost Effective Workflows" class="md-nav__link">
      Cost Effective Workflows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-hello-world" title="Simple Hello World" class="md-nav__link">
    Simple Hello World
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-definition" title="Workflow Definition" class="md-nav__link">
    Workflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#call-caching" title="Call Caching" class="md-nav__link">
    Call Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hello-world-with-inputs" title="Hello World with inputs" class="md-nav__link">
    Hello World with inputs
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-definition_1" title="Workflow Definition" class="md-nav__link">
    Workflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputs" title="Inputs" class="md-nav__link">
    Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow_1" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-data-on-s3" title="Using data on S3" class="md-nav__link">
    Using data on S3
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflow-definition_2" title="Workflow Definition" class="md-nav__link">
    Workflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputs_1" title="Inputs" class="md-nav__link">
    Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow_2" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-example-haplotypecaller" title="Real-world example: HaplotypeCaller" class="md-nav__link">
    Real-world example: HaplotypeCaller
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#worflow-definition" title="Worflow Definition" class="md-nav__link">
    Worflow Definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inputs_2" title="Inputs" class="md-nav__link">
    Inputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-workflow_3" title="Running the workflow" class="md-nav__link">
    Running the workflow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-genomics-workflows/edit/master/docs/orchestration/cromwell/cromwell-examples.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="cromwell-examples">Cromwell Examples</h1>
<div class="admonition error">
<p class="admonition-title">DEPRECATION NOTICE</p>
<p>This site and related code are no longer actively maintained.</p>
<p>This site will be disabled and the underlying Github repository will be <strong>archived on 2023-07-31</strong>. This allows all code and assets presented here to remain publicly available for historical reference purposes only.</p>
<p>For more up to date solutions to running Genomics workflows on AWS checkout:</p>
<ul>
<li><a href="https://aws.amazon.com/omics/">Amazon Omics</a> - a fully managed service for storing, processing, and querying genomic, transcriptomic, and other omics data into insights. <a href="https://docs.aws.amazon.com/omics/latest/dev/workflows.html">Omics Workflows</a> provides fully managed execution of pre-packaged <a href="https://docs.aws.amazon.com/omics/latest/dev/service-workflows.html">Ready2Run</a> workflows or private workflows you create using WDL or Nextflow.</li>
<li><a href="https://aws.amazon.com/genomics-cli/">Amazon Genomics CLI</a> - an open source tool that automates deploying and running workflow engines in AWS. AGC uses the same architectural patterns described here (i.e. operating workflow engines with AWS Batch). It provides support for running WDL, Nextflow, Snakemake, and CWL based workflows.</li>
</ul>
</div>
<p>The following are some example workflows you can use to test Cromwell on AWS.
The <code>curl</code> commands assume that you have access to a Cromwell server via <code>localhost:8000</code>.</p>
<h2 id="simple-hello-world">Simple Hello World</h2>
<p>This is a single file workflow.  It simply echos "Hello AWS!" to <code>stdout</code> and exits.</p>
<h3 id="workflow-definition">Workflow Definition</h3>
<p><code>simple-hello.wdl</code></p>
<pre><code class="language-java">task echoHello{
    command {
        echo &quot;Hello AWS!&quot;
    }
    runtime {
        docker: &quot;ubuntu:latest&quot;
    }

}

workflow printHelloAndGoodbye {
    call echoHello
}

</code></pre>
<h3 id="running-the-workflow">Running the workflow</h3>
<p>To submit this workflow via <code>curl</code> use the following command:</p>
<pre><code class="language-bash">$ curl -X POST &quot;http://localhost:8000/api/workflows/v1&quot; \
    -H  &quot;accept: application/json&quot; \
    -F &quot;workflowSource=@/path/to/simple-hello.wdl&quot;
</code></pre>
<p>You should receive a response like the following:</p>
<pre><code class="language-json">{&quot;id&quot;:&quot;104d9ade-6461-40e7-bc4e-227c3a49e98b&quot;,&quot;status&quot;:&quot;Submitted&quot;}
</code></pre>
<p>If the workflow completes successfully, the server will log the following:</p>
<pre><code>2018-09-21 04:07:42,928 cromwell-system-akka.dispatchers.engine-dispatcher-25 INFO  - WorkflowExecutionActor-7eefeeed-157e-4307-9267-9b4d716874e5 [UUID(7eefeeed)]: Workflow w complete. Final Outputs:
{
  &quot;w.echo.f&quot;: &quot;s3://aws-cromwell-test-us-east-1/cromwell-execution/w/7eefeeed-157e-4307-9267-9b4d716874e5/call-echo/echo-stdout.log&quot;
}
2018-09-21 04:07:42,931 cromwell-system-akka.dispatchers.engine-dispatcher-25 INFO  - WorkflowManagerActor WorkflowActor-7eefeeed-157e-4307-9267-9b4d716874e5 is in a terminal state: WorkflowSucceededState
</code></pre>
<h3 id="call-caching">Call Caching</h3>
<p>If you submit the same job again Cromwell will find in the metadata database
that the previous call to the <code>echoHello</code> task was completed successfully
(a cache hit). Rather than submitting the job to AWS Batch the server will simply
copy the previous result</p>
<p>You can disable call caching on a single workflow by providing a JSON options file:</p>
<pre><code class="language-JSON">{
    &quot;write_to_cache&quot;: false,
    &quot;read_from_cache&quot;: false
}
</code></pre>
<p>This file may be submitted along with the workflow:</p>
<pre><code class="language-bash">curl -X POST &quot;http://localhost:8000/api/workflows/v1&quot; \
     -H &quot;accept: application/json&quot; \
     -F &quot;workflowSource=@workflow.wdl&quot; \
     -F &quot;workflowOptions=@options.json&quot;
</code></pre>
<h2 id="hello-world-with-inputs">Hello World with inputs</h2>
<p>This workflow is virtually the same as the single file workflow above, but
uses an input file to define parameters in the workflow.</p>
<h3 id="workflow-definition_1">Workflow Definition</h3>
<p><code>hello-aws.wdl</code></p>
<pre><code class="language-java">task hello {
  String addressee
  command {
    echo &quot;Hello ${addressee}! Welcome to Cromwell . . . on AWS!&quot;
  }
  output {
    String message = read_string(stdout())
  }
  runtime {
    docker: &quot;ubuntu:latest&quot;
  }
}

workflow wf_hello {
  call hello

  output {
     hello.message
  }
}
</code></pre>
<h3 id="inputs">Inputs</h3>
<p><code>hello-aws.json</code></p>
<pre><code class="language-json">{
    &quot;wf_hello.hello.addressee&quot;: &quot;World!&quot;
}
</code></pre>
<h3 id="running-the-workflow_1">Running the workflow</h3>
<p>Submit this workflow using:</p>
<pre><code class="language-bash">$ curl -X POST &quot;http://localhost:8000/api/workflows/v1&quot; \
    -H  &quot;accept: application/json&quot; \
    -F &quot;workflowSource=@hello-aws.wdl&quot; \
    -F &quot;workflowInputs=@hello-aws.json&quot;
</code></pre>
<h2 id="using-data-on-s3">Using data on S3</h2>
<p>This workflow demonstrates how to use data from S3.</p>
<p>First, create some data:</p>
<pre><code class="language-bash">$ curl &quot;https://baconipsum.com/api/?type=all-meat&amp;paras=1&amp;format=text&quot; &gt; meats.txt
</code></pre>
<p>and upload it to an S3 bucket accessible using the Cromwell server's IAM policy:</p>
<pre><code class="language-bash">$ aws s3 cp meats.txt s3://&lt;your-bucket-name&gt;/
</code></pre>
<p>Create the following <code>wdl</code> and input <code>json</code> files.</p>
<h3 id="workflow-definition_2">Workflow Definition</h3>
<p><code>s3inputs.wdl</code></p>
<pre><code class="language-java">task read_file {
  File file

  command {
    cat ${file}
  }

  output {
    String contents = read_string(stdout())
  }

  runtime {
    docker: &quot;ubuntu:latest&quot;
  }
}

workflow ReadFile {
  call read_file

  output {
    read_file.contents
  }
}
</code></pre>
<h3 id="inputs_1">Inputs</h3>
<p><code>s3inputs.json</code></p>
<pre><code class="language-json">{
  &quot;ReadFile.read_file.file&quot;: &quot;s3://aws-cromwell-test-us-east-1/meats.txt&quot;
}
</code></pre>
<h3 id="running-the-workflow_2">Running the workflow</h3>
<p>Submit the workflow via <code>curl</code>:</p>
<pre><code class="language-bash">$ curl -X POST &quot;http://localhost:8000/api/workflows/v1&quot; \
    -H  &quot;accept: application/json&quot; \
    -F &quot;workflowSource=@s3inputs.wdl&quot; \
    -F &quot;workflowInputs=@s3inputs.json&quot;
</code></pre>
<p>If successful the server should log the following:</p>
<pre><code>2018-09-21 05:04:15,478 cromwell-system-akka.dispatchers.engine-dispatcher-25 INFO  - WorkflowExecutionActor-1774c9a2-12bf-42ea-902d-3dbe2a70a116 [UUID(1774c9a2)]: Workflow ReadFile complete. Final Outputs:
{
  &quot;ReadFile.read_file.contents&quot;: &quot;Strip steak venison leberkas sausage fatback pork belly short ribs.  Tail fatback prosciutto meatball sausage filet mignon tri-tip porchetta cupim doner boudin.  Meatloaf jerky short loin turkey beef kielbasa kevin cupim burgdoggen short ribs spare ribs flank doner chuck.  Cupim prosciutto jerky leberkas pork loin pastrami.  Chuck ham pork loin, prosciutto filet mignon kevin brisket corned beef short loin shoulder jowl porchetta venison.  Hamburger ham hock tail swine andouille beef ribs t-bone turducken tenderloin burgdoggen capicola frankfurter sirloin ham.&quot;
}
2018-09-21 05:04:15,481 cromwell-system-akka.dispatchers.engine-dispatcher-28 INFO  - WorkflowManagerActor WorkflowActor-1774c9a2-12bf-42ea-902d-3dbe2a70a116 is in a terminal state: WorkflowSucceededState
</code></pre>
<h2 id="real-world-example-haplotypecaller">Real-world example: HaplotypeCaller</h2>
<p>This example demonstrates how to use Cromwell with the AWS backend to run GATK4
HaplotypeCaller against public data in S3.  The HaplotypeCaller tool is one of the
primary steps in GATK best practices pipeline.</p>
<p>The source for these files can be found in <a href="https://github.com/broadinstitute/cromwell/tree/develop/centaur/src/main/resources/integrationTestCases/germline/haplotype-caller-workflow">Cromwell's test suite on GitHub</a>.</p>
<h3 id="worflow-definition">Worflow Definition</h3>
<p><code>HaplotypeCaller.aws.wdl</code></p>
<pre><code class="language-wdl">## Copyright Broad Institute, 2017
##
## This WDL workflow runs HaplotypeCaller from GATK4 in GVCF mode on a single sample
## according to the GATK Best Practices (June 2016), scattered across intervals.
##
## Requirements/expectations :
## - One analysis-ready BAM file for a single sample (as identified in RG:SM)
## - Set of variant calling intervals lists for the scatter, provided in a file
##
## Outputs :
## - One GVCF file and its index
##
## Cromwell version support
## - Successfully tested on v29
## - Does not work on versions &lt; v23 due to output syntax
##
## IMPORTANT NOTE: HaplotypeCaller in GATK4 is still in evaluation phase and should not
## be used in production until it has been fully vetted. In the meantime, use the GATK3
## version for any production needs.
##
## Runtime parameters are optimized for Broad's Google Cloud Platform implementation.
##
## LICENSING :
## This script is released under the WDL source code license (BSD-3) (see LICENSE in
## https://github.com/broadinstitute/wdl). Note however that the programs it calls may
## be subject to different licenses. Users are responsible for checking that they are
## authorized to run all programs before running this script. Please see the dockers
## for detailed licensing information pertaining to the included programs.

# WORKFLOW DEFINITION
workflow HaplotypeCallerGvcf_GATK4 {
  File input_bam
  File input_bam_index
  File ref_dict
  File ref_fasta
  File ref_fasta_index
  File scattered_calling_intervals_list

  String gatk_docker

  String gatk_path

  Array[File] scattered_calling_intervals = read_lines(scattered_calling_intervals_list)

  String sample_basename = basename(input_bam, &quot;.bam&quot;)

  String gvcf_name = sample_basename + &quot;.g.vcf.gz&quot;
  String gvcf_index = sample_basename + &quot;.g.vcf.gz.tbi&quot;

  # Call variants in parallel over grouped calling intervals
  scatter (interval_file in scattered_calling_intervals) {

    # Generate GVCF by interval
    call HaplotypeCaller {
      input:
        input_bam = input_bam,
        input_bam_index = input_bam_index,
        interval_list = interval_file,
        gvcf_name = gvcf_name,
        ref_dict = ref_dict,
        ref_fasta = ref_fasta,
        ref_fasta_index = ref_fasta_index,
        docker_image = gatk_docker,
        gatk_path = gatk_path
    }
  }

  # Merge per-interval GVCFs
  call MergeGVCFs {
    input:
      input_vcfs = HaplotypeCaller.output_gvcf,
      vcf_name = gvcf_name,
      vcf_index = gvcf_index,
      docker_image = gatk_docker,
      gatk_path = gatk_path
  }

  # Outputs that will be retained when execution is complete
  output {
    File output_merged_gvcf = MergeGVCFs.output_vcf
    File output_merged_gvcf_index = MergeGVCFs.output_vcf_index
  }
}

# TASK DEFINITIONS

# HaplotypeCaller per-sample in GVCF mode
task HaplotypeCaller {
  File input_bam
  File input_bam_index
  String gvcf_name
  File ref_dict
  File ref_fasta
  File ref_fasta_index
  File interval_list
  Int? interval_padding
  Float? contamination
  Int? max_alt_alleles

  String mem_size

  String docker_image
  String gatk_path
  String java_opt

  command {
    ${gatk_path} --java-options ${java_opt} \
      HaplotypeCaller \
      -R ${ref_fasta} \
      -I ${input_bam} \
      -O ${gvcf_name} \
      -L ${interval_list} \
      -ip ${default=100 interval_padding} \
      -contamination ${default=0 contamination} \
      --max-alternate-alleles ${default=3 max_alt_alleles} \
      -ERC GVCF
  }

  runtime {
    docker: docker_image
    memory: mem_size
    cpu: 1
  }

  output {
    File output_gvcf = &quot;${gvcf_name}&quot;
  }
}

# Merge GVCFs generated per-interval for the same sample
task MergeGVCFs {
  Array [File] input_vcfs
  String vcf_name
  String vcf_index

  String mem_size

  String docker_image
  String gatk_path
  String java_opt

  command {
    ${gatk_path} --java-options ${java_opt} \
      MergeVcfs \
      --INPUT=${sep=' --INPUT=' input_vcfs} \
      --OUTPUT=${vcf_name}
  }

  runtime {
    docker: docker_image
    memory: mem_size
    cpu: 1
  }

  output {
    File output_vcf = &quot;${vcf_name}&quot;
    File output_vcf_index = &quot;${vcf_index}&quot;
  }
}
</code></pre>
<h3 id="inputs_2">Inputs</h3>
<p>The inputs for this workflow reference <a href="https://registry.opendata.aws/gatk-test-data/">public data on S3</a> that is hosted by AWS as part of the <a href="https://aws.amazon.com/opendata/">AWS Public Dataset Program</a>.</p>
<p><code>HaplotypeCaller.aws.json</code></p>
<pre><code class="language-json">{
  &quot;##_COMMENT1&quot;: &quot;INPUT BAM&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.input_bam&quot;: &quot;s3://gatk-test-data/wgs_bam/NA12878_24RG_hg38/NA12878_24RG_small.hg38.bam&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.input_bam_index&quot;: &quot;s3://gatk-test-data/wgs_bam/NA12878_24RG_hg38/NA12878_24RG_small.hg38.bai&quot;,

  &quot;##_COMMENT2&quot;: &quot;REFERENCE FILES&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.ref_dict&quot;: &quot;s3://broad-references/hg38/v0/Homo_sapiens_assembly38.dict&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.ref_fasta&quot;: &quot;s3://broad-references/hg38/v0/Homo_sapiens_assembly38.fasta&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.ref_fasta_index&quot;: &quot;s3://broad-references/hg38/v0/Homo_sapiens_assembly38.fasta.fai&quot;,

  &quot;##_COMMENT3&quot;: &quot;INTERVALS&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.scattered_calling_intervals_list&quot;: &quot;s3://gatk-test-data/intervals/hg38_wgs_scattered_calling_intervals.txt&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.HaplotypeCaller.interval_padding&quot;: 100,

  &quot;##_COMMENT4&quot;: &quot;DOCKERS&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.gatk_docker&quot;: &quot;broadinstitute/gatk:4.0.0.0&quot;,

  &quot;##_COMMENT5&quot;: &quot;PATHS&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.gatk_path&quot;: &quot;/gatk/gatk&quot;,

  &quot;##_COMMENT6&quot;: &quot;JAVA OPTIONS&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.HaplotypeCaller.java_opt&quot;: &quot;-Xms8000m&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.MergeGVCFs.java_opt&quot;: &quot;-Xms8000m&quot;,

  &quot;##_COMMENT7&quot;: &quot;MEMORY ALLOCATION&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.HaplotypeCaller.mem_size&quot;: &quot;10 GB&quot;,
  &quot;HaplotypeCallerGvcf_GATK4.MergeGVCFs.mem_size&quot;: &quot;30 GB&quot;,
}
</code></pre>
<h3 id="running-the-workflow_3">Running the workflow</h3>
<p>Submit the workflow via <code>curl</code>:</p>
<pre><code class="language-bash">$ curl -X POST &quot;http://localhost:8000/api/workflows/v1&quot; \
    -H  &quot;accept: application/json&quot; \
    -F &quot;workflowSource=@HaplotypeCaller.aws.wdl&quot; \
    -F &quot;workflowInputs=@HaplotypeCaller.aws.json&quot;
</code></pre>
<p>This workflow takes about 60-90min to complete.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="cromwell-overview.html" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="cromwell-trouble-shooting.html" title="Trouble Shooting" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Trouble Shooting
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019 Amazon Web Services
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.9e1f3b71.js"></script>
      
      <script>app.initialize({version:"1.3.0",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>